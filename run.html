<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç­‹è‚‰å¾’ç«¶èµ°ğŸ”¥</title>
  <!-- ã‚²ãƒ¼ãƒ ã®ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤º -->
  <style>
    body {
      background-color: #ccc;
      margin: 0;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    #message, #goalText, #resultText, #retryLink, #boltLink {
      font-size: 32px;
      font-weight: bold;
      margin-top: 20px;
    }
    #countdown{
      display: none;
    }
    #goalText {
      color: red;
      display: none;
    }
    #resultText {
      color: green;
      display: none;
    }
    #retryLink, #boltLink {
      display: none;
      font-size: 20px;
    }
    #retryLink a, #boltLink a {
      text-decoration: none;
      color: blue;
    }
    canvas {
      display: block;
      margin: 20px auto;
      background-color: #d04b36;
      border: 4px solid #222;
    }
    #startButton {
      padding: 10px 30px;
      font-size: 24px;
      margin-top: 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #startButton:hover {
      background-color: #218838;
   }
  </style>
</head>
<body>
  <h1>ç­‹è‚‰å¾’ç«¶èµ°ğŸ”¥</h1>
  <div id="message">ã‚¹ãƒšãƒ¼ã‚¹ã‚’é€£æ‰“ã—ã¦é€Ÿãèµ°ã‚Œï¼</div>
  <!-- é–‹å§‹å‰ã®ãƒ«ãƒ¼ãƒ«èª¬æ˜ -->

  <div id="countdown"></div>
  <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º -->

  <div id="goalText">ğŸ‰ ã‚´ãƒ¼ãƒ«ï¼ ğŸ‰</div>
  <!-- ã‚´ãƒ¼ãƒ«åˆ°ç€æ™‚ã®ãƒ†ã‚­ã‚¹ãƒˆ -->

  <div id="resultText"></div>
  <!-- å‹æ•—çµæœè¡¨ç¤º -->

  <div id="retryLink"><a href="">ğŸ” ã‚‚ã†ä¸€åº¦èµ°ã‚‹ï¼</a></div>
  <!-- ãƒªãƒˆãƒ©ã‚¤ -->

  <div id="boltLink"><a href="https://www.youtube.com/watch?v=2O7K-8G2nwU" target="_blank">ğŸƒâ€â™‚ï¸ ã‚‚ã£ã¨é€Ÿã„äººã®å‹•ç”»</a></div>
  <!-- ã‚¦ã‚µã‚¤ãƒ³ãƒ»ãƒœãƒ«ãƒˆã®å‹•ç”»ãƒªãƒ³ã‚¯ -->

  <button id="startButton">ãƒ¬ãƒ¼ã‚¹ã‚’å§‹ã‚ã‚‹ï¼</button>
  <!-- ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ -->

  <canvas id="runner" width="900" height="300"></canvas>
  <!-- æ£’äººé–“ãŒèµ°ã‚‹ã‚­ãƒ£ãƒ³ãƒã‚¹ -->

  <script>
    const canvas = document.getElementById('runner');
    const ctx = canvas.getContext('2d');

    // å„èµ°è€…ã®åˆæœŸä½ç½®
    let x1 = 50, x2 = 50, x3 = 50;

    // è¶³ã®å‹•ãã‚’è¡¨ã™è§’åº¦ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
    let legAngle = 0;

    // ã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ã®ä½ç½®
    const goalX = 750;

    // ãƒ•ãƒ©ã‚°å¤‰æ•°ï¼ˆã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†ï¼‰
    let started = false; // ãƒ¬ãƒ¼ã‚¹ãŒé–‹å§‹ã—ãŸã‹ã©ã†ã‹
    let tapeCut = false; // ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã‚’åˆ‡ã£ãŸã‹
    let goalShown = false; // çµæœè¡¨ç¤ºãŒå®Œäº†ã—ãŸã‹
    let playerSpeed = 0; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ”ãƒ¼ãƒ‰

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºç”¨
    let countdownValue = null;

    // ğŸƒâ€â™‚ï¸ é †ä½é…åˆ—
    let rankOrder = [];

    // ğŸ’¥ ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§åŠ é€Ÿ
    let spacePressed = false;


    // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã‚‰åŠ é€Ÿï¼ˆãŸã ã—æŠ¼ã—ã£ã±ãªã—é˜²æ­¢ï¼‰
    document.addEventListener('keydown', (e) => {
      if (started && e.code === 'Space' && !spacePressed) {
        playerSpeed += 0.8; // â† ã“ã“ã§åŠ é€Ÿåº¦ã‚’èª¿æ•´ï¼ˆå¤§ããã™ã‚Œã°é€Ÿããªã‚‹ï¼‰
        spacePressed = true; //1å›ã®æŠ¼ä¸‹ã«ã¤ã1å›ã®åŠ é€Ÿ
      }
    });

    // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’é›¢ã—ãŸã‚‰å†ã³æŠ¼ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
    document.addEventListener('keyup', (e) => {
      if (e.code === 'Space') {
        spacePressed = false;
      }
    });

    // ğŸ•’ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
    function startCountdown() {
      setTimeout(() => {
        let count = 3;
        countdownValue = count;


      const interval = setInterval(() => {
        count--;
        if (count > 0) {
          countdownValue = count;
        } else if (count ===0) {
          countdownValue = 'ãƒ‘ãƒ³ãƒƒï¼ï¼'; // ã‚¹ã‚¿ãƒ¼ãƒˆã®æ›ã‘å£°
          setTimeout(() => {
          countdownValue = null;
          document.getElementById('message').style.display = 'none'; // èª¬æ˜æ–‡ã‚’éè¡¨ç¤º
          started = true; // ãƒ¬ãƒ¼ã‚¹é–‹å§‹
         },1000);
          clearInterval(interval);
        }
      }, 1000);
     }, 2000);
    }

    document.getElementById('startButton').addEventListener('click', () => {
      document.getElementById('startButton').style.display = 'none';
      startCountdown();
      animate();
    });

    // ğŸ ãƒˆãƒ©ãƒƒã‚¯
    function drawTrack() {
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 1;
      for (let y = 70; y <= 230; y += 60) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }

      if (!tapeCut) {
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(goalX, 50);
        ctx.lineTo(goalX, 250);
        ctx.stroke();
      }
    }

    // ğŸ’ª æ£’äººé–“
    function drawMuscularStickMan(x, y, legAngle, color, label = '', labelColor = 'white') {
      ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(x, y - 40, 10, 0, Math.PI * 2);
      ctx.stroke();

      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(x, y - 30);
      ctx.lineTo(x, y);
      ctx.stroke();

      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(x, y - 30);
      ctx.lineTo(x - 12, y - 25);
      ctx.moveTo(x, y - 30);
      ctx.lineTo(x + 12, y - 25);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x, y - 20);
      ctx.quadraticCurveTo(x - 22, y - 10, x - 17, y);
      ctx.moveTo(x, y - 20);
      ctx.quadraticCurveTo(x + 22, y - 10, x + 17, y);
      ctx.stroke();

      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.quadraticCurveTo(x - 15, y + 10, x - 18 * Math.cos(legAngle), y + 35);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.quadraticCurveTo(x + 15, y + 10, x + 18 * Math.cos(legAngle), y + 35);
      ctx.stroke();

      if (label) {
        ctx.fillStyle = labelColor;
        ctx.font = '16px sans-serif';
        ctx.fillText(label, x - 20, y - 50);
      }
    }

    // ğŸ† è¡¨å½°å°æç”»
    function drawPodium() {
      ctx.fillStyle = "#ffe";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#888";
      ctx.fillRect(350, 200, 60, 60); // 2ä½
      ctx.fillRect(430, 170, 60, 90); // 1ä½
      ctx.fillRect(510, 220, 60, 40); // 3ä½

      const getLabel = (name, pos) => {
        if (name === 'player') return pos === 0 ? 'ç¥' : 'ã‚ãªãŸ';
        return '';
      };

      const getColor = (pos) => ['gold', 'silver', 'brown'][pos];

      const names = ['player', 'opponent1', 'opponent2'];
      const xs = [460, 380, 540];
      const ys = [170, 200, 220];

      for (let i = 0; i < 3; i++) {
        drawMuscularStickMan(xs[i], ys[i], 0,
          ['black', 'blue', 'green'][names.indexOf(rankOrder[i])],
          getLabel(rankOrder[i], i),
          getColor(i)
        );
      }

      ctx.font = "28px sans-serif";
      ctx.fillStyle = "#d04b36";
      ctx.fillText("ğŸ‘‘ è¡¨å½°å¼ ğŸ‘‘", 370, 100);
    }

    // ğŸ¬ ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // ç”»é¢ã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¯ãƒªã‚¢

      drawTrack(); //ãƒˆãƒ©ãƒƒã‚¯ã®ç™½ç·šã‚’æç”»

      // å„æ£’äººé–“ã®æç”»ï¼ˆè¶³ã®è§’åº¦ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¾ï¼‰
      drawMuscularStickMan(x1, 100, Math.sin(legAngle), 'black', 'ã‚ãªãŸ');
      drawMuscularStickMan(x2, 160, Math.sin(legAngle + 1), 'blue');
      drawMuscularStickMan(x3, 220, Math.sin(legAngle + 2), 'green');

      legAngle += 0.2; // è¶³ã®å‹•ãã®é€²è¡Œ


      // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ã¯ãã®æ•°å­—ã‚’ä¸­å¤®ã«æç”»ã—ã¦ãƒ«ãƒ¼ãƒ—ç¶™ç¶š
      if (countdownValue !== null) {
        ctx.fillStyle = 'white';
        ctx.font = '64px sans-serif';
        ctx.fillText(countdownValue, canvas.width / 2 -30, canvas.height / 2);
        requestAnimationFrame(animate);
        return;
      }

      // æ¸›é€Ÿï¼ˆæ‘©æ“¦çš„ãªè¡¨ç¾ï¼‰
      if (playerSpeed > 0.5) playerSpeed -= 0.05;

      // ã‚´ãƒ¼ãƒ«åˆ¤å®šå‡¦ç†
      if (!tapeCut) {
        if (started) {
             // å„èµ°è€…ã‚’ç§»å‹•ã•ã›ã‚‹
        x1 += playerSpeed * 0.5;
        x2 += Math.random() * 2.8 + 2.0;
        x3 += Math.random() * 2.8 + 2.0;
        }

        // èª°ã‹ãŒã‚´ãƒ¼ãƒ«ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
        if (x1 >= goalX || x2 >= goalX || x3 >= goalX) {
          tapeCut = true;

          // é †ä½åˆ¤å®š
          const results = [
            { name: 'player', x: x1 },
            { name: 'opponent1', x: x2 },
            { name: 'opponent2', x: x3 }
          ];
          results.sort((a, b) => b.x - a.x); // é™é †ã«ä¸¦ã¹ã‚‹
          rankOrder = results.map(r => r.name); // åå‰ã®é…åˆ—ã«å¤‰æ›
        }
      } else if (!goalShown) {
        // çµæœè¡¨ç¤ºï¼ˆ1åº¦ã ã‘ï¼‰
        document.getElementById('goalText').style.display = 'block';
        document.getElementById('resultText').textContent =
          rankOrder[0] === 'player' ? 'ğŸ† å„ªå‹ï¼ç­‹è‚‰æœ€å¼·ï¼ç­‹è‚‰ã“ããŒæ­£ç¾©ï¼' : 'ğŸ˜“ è² ã‘â€¦ç­‹ãƒˆãƒ¬ã—ã¦ãƒªãƒ™ãƒ³ã‚¸ï¼';
        document.getElementById('resultText').style.display = 'block';
        document.getElementById('retryLink').style.display = 'block';
        document.getElementById('boltLink').style.display = 'block';

        // è¡¨å½°å¼ã‚’2ç§’å¾Œã«æç”»
        setTimeout(() => {
          drawPodium();
        }, 2000);

        goalShown = true;
      }

      // ã‚´ãƒ¼ãƒ«ã—ã¦ã„ãªã„é–“ã¯æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
      if (!goalShown) requestAnimationFrame(animate);
    }
  </script>
</body>
</html>